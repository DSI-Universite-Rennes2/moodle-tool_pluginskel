define(["jquery"],function(a){var b={deleteElements:function(b,c,d){var e,f,g;if(d){var h=c[0];e=c[1],g=h+"_"+e,f=h+"["+e+"]"}else e=c[0],f=e,g=e;var i=g+"count",j=parseInt(a('[name="'+i+'"]').val());if(1!=j){var k;for(var l in b)if(b[l].name==e){k=b[l];break}var m=j-1;a("#id_"+g+" br").last().remove();for(l in k.values){var n=k.values[l],o="fitem_id_"+g+"_"+m+"_"+n.name;if(a("#"+o).remove(),"numeric-array"===n.hint){var p=g+"_"+m+"_"+n.name+"count",q=parseInt(a("[name='"+p+"']").val());q>=2&&a("#id_"+g+" br").slice(-(q-1)).remove();for(var r in n.values)for(var s=n.values[r],t=0;q>t;t++){var u=o+"_"+t+"_"+s.name;a("#"+u).remove()}var v="fitem_id_addmore_"+g+"_"+m+"_"+n.name;a("#"+v).remove(),a("[name='"+p+"']").remove()}}a('[name="'+i+'"]').val(j-1)}},addMoreRootElements:function(c,d,e){var f,g,h;if(e){var i=d[0];f=d[1],g=i+"["+f+"]",h=i+"_"+f}else f=d[0],g=f,h=f;var j,k=h+"count",l=parseInt(a('[name="'+k+'"]').val());for(var m in c)if(c[m].name==f){j=c[m];break}var n,o=l-1,p="<br/>";for(m in j.values){var q=j.values[m],r=g+"["+l+"]["+q.name+"]",s="id_"+h+"_"+l+"_"+q.name,t=g+"["+o+"]["+q.name+"]",u="id_"+h+"_"+o+"_"+q.name;if("numeric-array"==q.hint){var v=a("#fitem_"+u).attr("class");p+='<div id="fitem_'+s+'" class="'+v+'">',p+=a("#fitem_"+u).html(),p+="</div>";for(var w in q.values){var x=q.values[w],y=r+"[0]["+x.name+"]",z=s+"_0_"+x.name,A=t+"[0]["+x.name+"]",B=u+"_0_"+x.name;p+=b.cloneElement(A,B,y,z)}var C="id_addmore_"+h+"_"+l+"_"+q.name,D="addmore_"+g+"["+l+"]["+q.name+"]",E="id_addmore_"+h+"_"+o+"_"+q.name,F="addmore_"+g+"["+o+"]["+q.name+"]";p+=b.cloneElement(F,E,D,C);var G=h+"_"+o+"_"+q.name+"count",H=h+"_"+l+"_"+q.name+"count",I='<input name="'+H+'" value="1" type="hidden"></input>';a('[name="'+G+'"]').after(I)}else p+=b.cloneElement(t,u,r,s)}a("#fgroup_id_buttons_"+h).before(p),n="id_"+h+"_"+l,b.removeInputFromNewNode(j,n),a('[name="'+k+'"]').val(l+1)},addMoreNestedElements:function(c,d,e,f){var g,h,i,j;f?e?(g=d[0]+"["+d[1]+"]["+d[2]+"]",h=d[0]+"_"+d[1]+"_"+d[2],i=d[1],j=d[2]):(g=d[0]+"["+d[1]+"]",h=d[0]+"_"+d[1],i=d[0],j=d[1]):e?(g=d[0]+"["+d[1]+"]["+d[2]+"]",g=g+"["+d[3]+"]",h=d[0]+"_"+d[1]+"_"+d[2]+"_"+d[3],i=d[1],j=d[3]):(g=d[0]+"["+d[1]+"]["+d[2]+"]",h=d[0]+"_"+d[1]+"_"+d[2],i=d[0],j=d[2]);var k,l=h+"count",m=parseInt(a('[name="'+l+'"]').val());for(var n in c)if(c[n].name==i)for(var o in c[n].values)if(c[n].values[o].name==j){k=c[n].values[o];break}var p=m-1,q="<br/>";for(n in k.values){var r=k.values[n],s=g+"["+m+"]["+r.name+"]",t="id_"+h+"_"+m+"_"+r.name,u=g+"["+p+"]["+r.name+"]",v="id_"+h+"_"+p+"_"+r.name;q+=b.cloneElement(u,v,s,t)}a("#fitem_id_addmore_"+h).before(q);var w="id_"+h+"_"+m;b.removeInputFromNewNode(k,w),a('[name="'+l+'"]').val(m+1)},removeInputFromNewNode:function(c,d){for(var e in c.values){var f=c.values[e],g=d+"_"+f.name;if(("text"==f.hint||"int"==f.hint)&&a("#"+g).removeAttr("value"),"multiple-options"==f.hint){var h="required"in f&&f.required===!0;h||a("#"+g+' option[value="undefined"]').prop("selected",!0).change()}if("numeric-array"==f.hint){var i=g+"_0";b.removeInputFromNewNode(f,i)}}},cloneElement:function(b,c,d,e){for(var f=a("#fitem_"+c).attr("class"),g=a("#fitem_"+c).html();-1!=g.indexOf(c);)g=g.replace(c,e);for(;-1!=g.indexOf(b);)g=g.replace(b,d);var h='<div id="fitem_'+e+'" class="'+f+'">';return h+=g,h+="</div>"},addMore:function(){a(document).ready(function(){a(".mform").on("click",":button",function(c){var d=c.target.name;if(-1!==d.indexOf("addmore_")||-1!==d.indexOf("delete_")){var e,f,g=a.parseJSON(a('[name="templatevars"]').val()),h=a('[name="componenttype1"]').val(),i=h+"_features";-1!==d.indexOf("addmore_")?(e=!0,f=d.replace("addmore_","")):(f=d.replace("delete_",""),e=!1);var j=f.split(/\]\[|\[|\]/gi);0===j[j.length-1].length&&j.pop();var k;k=j[0]===i?!0:!1;var l=!1;for(var m in j)if(a.isNumeric(j[m])){l=!0;break}var n=!1;l||(k&&3===j.length&&(l=!0,n=!0),k||2!==j.length||(l=!0,n=!0)),e?l?b.addMoreNestedElements(g,j,k,n):b.addMoreRootElements(g,j,k):b.deleteElements(g,j,k)}})})}};return b});